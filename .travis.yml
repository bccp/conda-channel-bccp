language: C

os:
  - linux
  - osx

env:
    matrix:
        -  PYTHON_VERSION=3.7
        -  PYTHON_VERSION=2.7
        -  PYTHON_VERSION=3.6


before_install:
    - if [ $TRAVIS_BRANCH == coverity_scan -a ${TRAVIS_JOB_NUMBER##*.} != 1 ]; then exit 0; fi
    - if [ $TRAVIS_OS_NAME == "linux" ]; then wget http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi
    - if [ $TRAVIS_OS_NAME == "osx" ]; then wget http://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh; bash osxinit.sh; fi
    - bash ./miniconda.sh -b -p $HOME/miniconda
    - export PATH=$HOME/miniconda/bin:$PATH
    - conda update --yes conda

install:
    - conda create -q --yes -n test python=$PYTHON_VERSION cmake
    - source activate test
    - conda install -y -q -c bccp nbodykit mpi4py

script:
    - mpirun -n 1 python test_environment.py
